<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Writing Effort & Lexical Analyzer</title>

<style>
:root {
  --bg: #0f1220;
  --card: rgba(255,255,255,0.08);
  --text: #eaeaf0;
  --muted: #9aa0b4;
  --accent: #7dd3fc;
  --warn: #facc15;
  --danger: #fb7185;
  --success: #4ade80;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: radial-gradient(circle at top, #1a1f3a, var(--bg));
  color: var(--text);
}

.container {
  max-width: 1100px;
  margin: 40px auto;
  padding: 20px;
}

h1 { font-weight: 600; }

.card {
  background: var(--card);
  backdrop-filter: blur(12px);
  border-radius: 14px;
  padding: 20px;
  margin-bottom: 20px;
}

textarea {
  width: 100%;
  min-height: 220px;
  background: rgba(0,0,0,0.35);
  color: var(--text);
  border: none;
  border-radius: 10px;
  padding: 16px;
  font-size: 16px;
  line-height: 1.6;
  outline: none;
}

.metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
  gap: 14px;
}

.metric {
  background: rgba(255,255,255,0.05);
  padding: 14px;
  border-radius: 10px;
}

.metric span {
  font-size: 13px;
  color: var(--muted);
}

.metric strong {
  font-size: 22px;
}

.highlight {
  background: rgba(251,113,133,0.25);
  border-bottom: 2px dashed var(--danger);
}

.phase {
  font-size: 14px;
}

#timeline {
  height: 14px;
  border-radius: 10px;
  overflow: hidden;
  margin-top: 10px;
}
.segment { height: 100%; float: left; }

.footer {
  text-align: center;
  font-size: 13px;
  color: var(--muted);
  margin-top: 40px;
}
</style>
</head>

<body>
<div class="container">

<h1>ðŸ§  Writing Effort & Lexical Analyzer</h1>

<div class="card">
  <p>
    This research prototype analyzes <strong>writing effort, lexical accuracy, and self-regulatory behavior</strong>
    during English essay writing. It is descriptive, not evaluative.
  </p>
  <textarea id="editor" placeholder="Write your English essay here..."></textarea>
</div>

<div class="card metrics">
  <div class="metric"><span>Total Words</span><strong id="words">0</strong></div>
  <div class="metric"><span>Recognized Words</span><strong id="correct">0</strong></div>
  <div class="metric"><span>Unrecognized Words</span><strong id="incorrect">0</strong></div>
  <div class="metric"><span>Spelling Accuracy</span><strong id="accuracy">0%</strong></div>
  <div class="metric"><span>Revision Load</span><strong id="revisions">0</strong></div>
  <div class="metric"><span>Pause Load</span><strong id="pauses">0%</strong></div>
</div>

<div class="card">
  <span class="phase">Current Writing Phase: <strong id="phase">Idle</strong></span>
  <div id="timeline"></div>
</div>

<div class="footer">
  Educational research prototype Â· Process-based writing analytics Â· Vanilla JS
</div>

</div>

<script>
// --- Minimal dictionary (extendable) ---
const dictionary = new Set([
  "the","and","to","of","is","in","that","it","for","as","with","was","are","on",
  "this","by","be","or","from","at","an","which","but","not","have","has","had",
  "education","learning","student","teacher","technology","research","writing",
  "essay","language","english","process","effort","analysis","data","cognitive"
]);

const editor = document.getElementById("editor");

let startTime = null;
let lastKeyTime = null;
let totalPauseTime = 0;
let deletions = 0;
let segments = [];

const MICRO = 300;
const MACRO = 2000;

editor.addEventListener("keydown", e => {
  const now = performance.now();
  if (!startTime) startTime = now;

  if (lastKeyTime) {
    const gap = now - lastKeyTime;
    if (gap > MICRO) totalPauseTime += gap;
  }

  if (e.key === "Backspace" || e.key === "Delete") deletions++;
  lastKeyTime = now;
  update();
});

function inferPhase() {
  if (!lastKeyTime) return "Idle";
  const gap = performance.now() - lastKeyTime;
  if (gap > MACRO) return "Planning";
  if (deletions > 10) return "Revising";
  return "Drafting";
}

function updateTimeline(phase) {
  const colors = {
    Planning: "#fb7185",
    Drafting: "#4ade80",
    Revising: "#facc15",
    Idle: "#64748b"
  };
  segments.push(colors[phase]);
  if (segments.length > 50) segments.shift();

  const timeline = document.getElementById("timeline");
  timeline.innerHTML = "";
  segments.forEach(() => {
    const d = document.createElement("div");
    d.className = "segment";
    d.style.width = (100 / segments.length) + "%";
    d.style.background = colors[phase];
    timeline.appendChild(d);
  });
}

function update() {
  const text = editor.value;
  const words = text.match(/\b[a-zA-Z]+\b/g) || [];

  let correct = 0;
  let incorrect = 0;

  words.forEach(w => {
    if (dictionary.has(w.toLowerCase())) correct++;
    else incorrect++;
  });

  const accuracy = words.length
    ? ((correct / words.length) * 100).toFixed(1)
    : 0;

  const elapsed = startTime ? performance.now() - startTime : 1;
  const pauseLoad = Math.min((totalPauseTime / elapsed) * 100, 100).toFixed(1);
  const phase = inferPhase();

  document.getElementById("words").textContent = words.length;
  document.getElementById("correct").textContent = correct;
  document.getElementById("incorrect").textContent = incorrect;
  document.getElementById("accuracy").textContent = accuracy + "%";
  document.getElementById("revisions").textContent = deletions;
  document.getElementById("pauses").textContent = pauseLoad + "%";
  document.getElementById("phase").textContent = phase;

  updateTimeline(phase);
}
</script>
</body>
</html>
