<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SRL Writing Companion</title>

<style>
:root{
  --bg:#0f1220; --card:rgba(255,255,255,.08);
  --text:#eaeaf0; --muted:#9aa0b4;
  --accent:#7dd3fc; --success:#4ade80;
}
body{
  margin:0; font-family:system-ui;
  background:radial-gradient(circle at top,#1a1f3a,var(--bg));
  color:var(--text);
}
.container{max-width:900px;margin:30px auto;padding:20px;}
.chat{
  background:var(--card); border-radius:16px;
  padding:20px; margin-bottom:20px;
}
.msg{margin-bottom:14px;}
.bot{color:var(--accent);}
.user{color:var(--success);}
textarea{
  width:100%; min-height:160px;
  background:rgba(0,0,0,.4); color:var(--text);
  border:none; border-radius:12px;
  padding:14px; font-size:15px;
}
button{
  margin-top:10px; padding:10px 18px;
  border:none; border-radius:10px;
  background:var(--accent); color:#000;
  cursor:pointer;
}
.metrics{
  display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:12px;
}
.metric{
  background:var(--card); padding:14px;
  border-radius:12px;
}
.metric span{font-size:13px;color:var(--muted);}
.metric strong{font-size:20px;}
.footer{
  text-align:center; font-size:13px;
  color:var(--muted); margin-top:30px;
}
</style>
</head>

<body>
<div class="container">

<h1>ðŸ§  SRL Writing Companion</h1>

<div class="chat" id="chat">
  <div class="msg bot">ðŸ‘‹ Hello. Before you start writing, letâ€™s plan.</div>
  <div class="msg bot">What is your goal for this task?</div>
</div>

<textarea id="input" placeholder="Type your response or start writing your assignment..."></textarea>
<button onclick="submit()">Send</button>

<div class="metrics">
  <div class="metric"><span>Detected SRL Phase</span><strong id="phase">Planning</strong></div>
  <div class="metric"><span>Persistence</span><strong id="persist">â€”</strong></div>
  <div class="metric"><span>Monitoring Load</span><strong id="monitor">0</strong></div>
  <div class="metric"><span>Reflection Depth</span><strong id="reflect">â€”</strong></div>
</div>

<div class="footer">
Self-Regulated Learning Â· Conversational Process Analytics Â· Vanilla JS
</div>

</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

let phase = "Planning";
let lastKey = null;
let pauses = 0;
let deletions = 0;
let wordsWritten = 0;
let reflectionLength = 0;

const MICRO = 300;
const INACTIVITY = 120000;
let idleTimer;

function bot(text){
  const d=document.createElement("div");
  d.className="msg bot";
  d.textContent="ðŸ¤– "+text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

function user(text){
  const d=document.createElement("div");
  d.className="msg user";
  d.textContent="ðŸ§‘ "+text;
  chat.appendChild(d);
}

input.addEventListener("keydown",e=>{
  const now=performance.now();
  if(lastKey){
    const gap=now-lastKey;
    if(gap>MICRO) pauses+=gap;
  }
  if(e.key==="Backspace") deletions++;
  lastKey=now;
  resetIdle();
});

function resetIdle(){
  clearTimeout(idleTimer);
  idleTimer=setTimeout(()=>{
    bot("Take your time. Try writing one more sentence.");
  },INACTIVITY);
}

function submit(){
  const text=input.value.trim();
  if(!text) return;

  user(text);
  input.value="";

  const wordCount=text.split(/\s+/).length;
  wordsWritten+=wordCount;

  if(phase==="Planning"){
    bot("Great. Now start writing your assignment.");
    phase="Performance";
  }
  else if(phase==="Performance" && wordsWritten>120){
    bot("Youâ€™ve written a lot. What part was most challenging?");
    phase="Reflection";
  }
  else if(phase==="Reflection"){
    reflectionLength+=wordCount;
    bot("Thank you. What would you improve next time?");
  }

  updateMetrics();
}

function updateMetrics(){
  document.getElementById("phase").textContent=phase;
  document.getElementById("persist").textContent=
    wordsWritten>150?"High":wordsWritten>60?"Moderate":"Low";
  document.getElementById("monitor").textContent=deletions;
  document.getElementById("reflect").textContent=
    reflectionLength>40?"Deep":reflectionLength>15?"Moderate":"Surface";
}
</script>
</body>
</html>
