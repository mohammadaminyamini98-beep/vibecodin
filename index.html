<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SRL Writing Phase Assistant</title>

<style>
:root{
  --bg:#0f1220;
  --panel:rgba(255,255,255,0.08);
  --text:#eaeaf0;
  --muted:#9aa0b4;
  --accent:#7dd3fc;
}
body{
  margin:0;
  font-family:system-ui;
  background:radial-gradient(circle at top,#1a1f3a,var(--bg));
  color:var(--text);
}
.container{
  max-width:1100px;
  margin:30px auto;
  padding:20px;
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:20px;
}
.panel{
  background:var(--panel);
  border-radius:16px;
  padding:20px;
}
textarea{
  width:100%;
  min-height:360px;
  background:rgba(0,0,0,0.4);
  color:var(--text);
  border:none;
  border-radius:14px;
  padding:18px;
  font-size:16px;
  line-height:1.6;
}
h2{margin-top:0;font-weight:500;}
.metric{margin-bottom:14px;}
.metric span{
  display:block;
  font-size:13px;
  color:var(--muted);
}
.metric strong{
  font-size:20px;
}
#coach{
  margin-top:18px;
  padding:14px;
  border-radius:12px;
  background:rgba(125,211,252,0.15);
  color:var(--accent);
}
.footer{
  grid-column:1/-1;
  text-align:center;
  color:var(--muted);
  font-size:13px;
  margin-top:20px;
}
</style>
</head>

<body>
<div class="container">

<!-- Writing Area -->
<div class="panel">
  <h2>Writing Task</h2>
  <p style="color:var(--muted)">
    Write your essay naturally. The system observes patterns over time
    to support your writing process.
  </p>
  <textarea id="editor" placeholder="Start writing here..."></textarea>
  <div id="coach"></div>
</div>

<!-- Phase Panel -->
<div class="panel">
  <h2>Writing Phase Support</h2>

  <div class="metric">
    <span>Likely Current Phase</span>
    <strong id="phase">Planning</strong>
  </div>

  <div class="metric">
    <span>Why this phase?</span>
    <strong id="reason">—</strong>
  </div>

  <div class="metric">
    <span>Suggested Focus</span>
    <strong id="suggestion">—</strong>
  </div>
</div>

<div class="footer">
SRL-based writing support · Pattern-based phase inference · Single-file prototype
</div>

</div>

<script>
const editor = document.getElementById("editor");
const coach = document.getElementById("coach");

let events = [];
let startTime = null;
let lastKeyTime = null;

const WINDOW = 60000; // 60 seconds
const MICRO = 300;
const INACTIVITY = 120000;

let idleTimer;

// --- Event logging ---
editor.addEventListener("keydown", e => {
  const now = performance.now();
  if (!startTime) startTime = now;

  let type = "type";
  if (e.key === "Backspace" || e.key === "Delete") type = "delete";

  events.push({ time: now, type });
  events = events.filter(ev => now - ev.time <= WINDOW);

  lastKeyTime = now;
  hideCoach();
  resetIdle();
  updatePhase();
});

// --- Inactivity support ---
function resetIdle(){
  clearTimeout(idleTimer);
  idleTimer = setTimeout(() => {
    coach.textContent =
      "You’ve paused for a while. In planning phases, it helps to jot down rough ideas or keywords.";
    coach.style.display = "block";
  }, INACTIVITY);
}
function hideCoach(){ coach.style.display = "none"; }

// --- Phase inference ---
function inferPhase(){
  if (events.length < 5) {
    return {
      phase: "Planning",
      reason: "Very little recent activity",
      suggestion: "Think about your main idea or outline briefly."
    };
  }

  const types = events.map(e => e.type);
  const deletes = types.filter(t => t === "delete").length;
  const typesCount = types.length;

  const deleteRatio = deletes / typesCount;
  const words = editor.value.trim().split(/\s+/).length;
  const elapsed = startTime ? performance.now() - startTime : 1;
  const pauseRatio =
    lastKeyTime ? (performance.now() - lastKeyTime) / elapsed : 0;

  // ---- PLANNING ----
  if (deleteRatio > 0.35 || words < 40) {
    return {
      phase: "Planning",
      reason: "Short bursts, revisions, or early drafting",
      suggestion: "List ideas, write fragments, or sketch your structure."
    };
  }

  // ---- MONITORING ----
  if (deleteRatio > 0.2 && words > 60) {
    return {
      phase: "Monitoring",
      reason: "Frequent revisions of existing text",
      suggestion: "Check clarity and organization, not small details yet."
    };
  }

  // ---- PERFORMANCE ----
  if (deleteRatio < 0.15 && pauseRatio < 0.25) {
    return {
      phase: "Performance",
      reason: "Sustained writing with few interruptions",
      suggestion: "Focus on expressing ideas without over-editing."
    };
  }

  // ---- REFLECTION ----
  if (words > 200 && pauseRatio > 0.4) {
    return {
      phase: "Reflection",
      reason: "Writing slowed after substantial text",
      suggestion: "Think about strengths and what you’d revise next."
    };
  }

  return {
    phase: "Planning",
    reason: "Mixed signals",
    suggestion: "Clarify your next idea before continuing."
  };
}

// --- Update UI ---
function updatePhase(){
  const result = inferPhase();
  document.getElementById("phase").textContent = result.phase;
  document.getElementById("reason").textContent = result.reason;
  document.getElementById("suggestion").textContent = result.suggestion;
}
</script>
</body>
</html>
